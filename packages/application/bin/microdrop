#!/usr/bin/env electron
require('pkginfo')(module);
const Microdrop = require('../index.js');
const electron = require('electron');
const isDev = require('electron-is-dev');

// const PKG_NAME = module.exports.name;
const env = module.exports.environment;

if (!isDev) process.argv.unshift('');

const argv = require('yargs')
  .command('open <file>', 'open MicrodropFile')
  .default('http-port', env.HTTP_PORT)
  .default('mqtt-ws-port', env.MQTT_WS_PORT)
  .default('mqtt-tcp-port', env.MQTT_TCP_PORT)
  .describe('reset', 'Reset MicroDrop data')
  .argv;

// Set defaults
const ports = {
  http_port:     argv.httpPort,
  mqtt_ws_port:  argv.mqttWsPort,
  mqtt_tcp_port: argv.mqttTcpPort
};

if (argv.reset == true) {
  Microdrop.reset(electron, ports).then((d) => {
    process.exit();
    // electron.app.exit();
  });
} else {
  console.log({ports});
  Microdrop(electron, ports, argv.file);
}
