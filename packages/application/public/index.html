<!DOCTYPE html>
<html style="height:100%;">
  <head>
    <meta charset="UTF-8">
    <title>MicroDrop</title>
  </head>
  <body style="height:100%; overflow:hidden;">
    <script>
      // You can also require other files to run in this process
      const {ipcRenderer, remote} = require('electron');
      const {Menu, MenuItem} = remote;
      const yo = require('yo-yo');

      ipcRenderer.on('ready', (e, data) => {
        var ports = JSON.parse(data).ports;
        const content = yo`<div style="height:100%"></div>`;

        const switchView = (tab) => {
          content.innerHTML = '';
          const view = yo`
            <webview src="http://localhost:${ports.http_port}/${tab}"
            style="
            top: 0px;
            width: 100%;
            height: 100%;
            margin: 0px;
            left: 0px;
            z-index: -1;
            ">
            </webview>
          `;

          content.appendChild(view);
        }

        let menu;

        let display = {label: 'Display', click: switchView.bind(this, 'display')};
        let uiManager = {label: 'UI Plugin Manager', click: switchView.bind(this, 'ui-plugins')};
        let processManager = {label: 'Process Plugin Manager',  click: switchView.bind(this, 'process-plugins')};

        if (process.platform != 'darwin') {
          menu = new Menu();
          menu.append(new MenuItem(display));
          menu.append(new MenuItem(uiManager));
          menu.append(new MenuItem(processManager));
          Menu.setApplicationMenu(menu);
        } else {
          const template = [
            {},
            {
              label: 'Show',
              submenu: [ display, uiManager, processManager]
            }
          ];
          menu = Menu.buildFromTemplate(template);
        }

        Menu.setApplicationMenu(menu);

        document.body.appendChild(content);
        switchView('display')
      });

    </script>
  </body>
</html>
